---
keywords: [intermediate, tutorial, identity, credentials, verifiable credentials, relying party]
---

import { MarkdownChipRow } from "/src/components/Chip/MarkdownChipRow";
import useBaseUrl from "@docusaurus/useBaseUrl";

# Become a relying party

<MarkdownChipRow labels={["Intermediate", "Tutorial"]} />

## Overview


https://github.com/dfinity/verifiable-credentials-sdk/tree/main/js-library
Outline
Request credentials to issuers through an identity provider that supports the verifiable credentials specification. Typically Internet Identity.
Requirement: The user is logged in with the identity provider.
Two steps
Request credentials. How to use the JS library
More details on how the flow works are in “How it Works” section or the specifications document.
Verify the credentials. Explanation
Example: https://github.com/dfinity/vc-playground/blob/b2f8cd5f5397b7b355b6503df5af3789834b79e9/rp/src/main.rs#L262


A relying party is a service or app that requests a user's verifiable credentials from the [issuer](issuer.mdx) of those credentials. Relying parties use the identity provider API to communicate with the issuer using an identity provider such as Internet Identity. This API uses the [`window.postMessage()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) interface.

##  Using the identity provider API

To implement a relying party service, your canister must support three steps.

1. Load Internet Identity:
2. Request credentials:
3. Receive a response:


### Step 1: Load Internet Identity in a new window.

First, your canister must initiative and load Internet Identity in a new window with the URL path `/vc-flow`. Opening this window will trigger II to load and send a notification to `window.opener` with the following JSON-RPC content:

```json
{
  "jsonrpc": "2.0",
  "method": "vc-flow-ready"
}
```

### Step 2: Request a verifiable credential

Once Internet Identity is ready, the relying party service can request a verifiable credential for a user by sending a JSON RPC request to the issuer. The user must be logged into the identity provider for the request to be successful. Below is an example of a JSON RPC request:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "request_credential",
  "params": {
    "issuer": {
        "origin": "https://employment-info.com",
        "canisterId": "rwlgt-iiaaa-aaaaa-aaaaa-cai"
    },
    "credentialSpec": {
        "credentialType": "VerifiedEmployee",
        "arguments": {
          "employerName": "XYZ Ltd."
        }
    },
    "credentialSubject": "2mdal-aedsb-hlpnv-qu3zl-ae6on-72bt5-fwha5-xzs74-5dkaz-dfywi-aqe"
  }
}
```

In this request, the following parameters must be set:

- `method`: `request_credential`: Uses the method for requesting a verifiable credential.

- `params`: Configuration parameters to identify which credential is being requested.

    - `issuer`: The information to identify which issuer the request is sent to.

        - `origin`: The origin URL of the issuer.

        - `canisterId`: The canister ID of the issuer. This field is optional.

  - `credentialSpec`: The specification of the credential being requested.

    - `credentialType`: The type of the requested credential.

    - `arguments`: Arguments mapping key value pairs that are specific to the credential. This field is optional.

  - `credentialSubject`: The principal of the user requesting the credential.

  - `derivationOrigin`: An origin that should be used for principal derivation as an alternative to the client origin. This field is optional.


Additional examples can be found in the [verifiable credentials specification](https://github.com/dfinity/internet-identity/blob/main/docs/vc-spec.md#examples).

### JavaScript SDK for verifiable credentials

The [JavaScript SDK for VCs](https://github.com/dfinity/verifiable-credentials-sdk/tree/main/js-library) can be used to send these JSON RPC requests programmatically using the `requestVerifiablePresentation` function. Below is an example:

```javascript
import { requestVerifiablePresentation } from "@dfinity/verifiable-credentials/request-verifiable-presentation";

requestVerifiablePresentation({
  onSuccess: async (verifiablePresentation: VerifiablePresentationResponse) => {
    // Called when the flow finishes successfully.
  },
  onError() {
    // Called when there is a technical error.
  },
  issuerData: {
    origin: "<url of the origin>",
    canisterId: "<[optional] canister id>",
  },
  credentialData: {
    credentialSpec: {
      credentialType: '<credential type as expected by issuer>',
      arguments: {
        // Arguments to verify with the credential
      },
    },
    credentialSubject: "<user's principal>",
  },
  identityProvider: "<[optional] url identity provider>",
  derivationOrigin: "<[optional] origin for delegated identity>",
  windowOpenerFeatures: "<[optional] window opener config string>",
});
```

[Learn more about the JavaScript SDK for VCs](https://github.com/dfinity/verifiable-credentials-sdk/tree/main/js-library).

This code executes the following steps:

The function performs the following steps:

- Opens a new window or tab with the identity provider (Internet Identity).

- Waits for a window post message from II.

- Sends a request to II through the window post message.

- Waits for the response from the II.

- Calls an `onSuccess` callback if the process was successful, but that does necessarily mean that a credential was received.

- Calls an `onError` callback if the process has some technical error, if the user closes the II window, or if II times out.

### 3: Receive a response

If the JSON RPC request is successfully sent and received by the issuer, Internet Identity will return the following JSON RPC response to the relying party:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "result": {
    "verifiablePresentation": "eyJQ..."
  }
}
```

In this response, `verifiablePresentation`is a JWT based verifiable presentation (VP) containing two credentials:

    1. A verifiable credential issued by Internet Identity that relates the `credentialSubject` to the user principal.

    2. A verifiable credential issued by the issuer to the user principal.

The order of the credentials in the VP should match the order above, such that the credential relating to the `credentialSubject` to the user principal should come first.

[View an example of a verifiable presentation](https://www.w3.org/TR/vc-data-model/#example-jwt-payload-of-a-jwt-based-verifiable-presentation-non-normative) for reference.

The relying party should not expect to receive an immediate response, as it should wait for one of the following events:

- II sends a JSON-RPC response as described above.

-  II sends a JSON-RPC error response as described below.

- The user closes the II window. This should be treated as an error.

The relying party may also close the II window after some timeout. The user would then be notified by the relying party that the request failed.

### Error messages

If the workflow failed for any reason, Internet Identity will return an error. The error does not provide details on the cause of the failure for privacy protection.

An example error can be found below:

``` json
{
    "id": 1,
    "jsonrpc": "2.0",
    "error": {
        "version": "1",
        "code": "UNKNOWN"
    }
}
```

## Verifying the credentials

### Recommended convention connecting credential specification with the returned credentials.

Service discovery and syntax of the claims in the returned credentials are out of scope
of this spec (of the MVP service).  However, an issuer may follow the convention below,
for an easier verification of the returned credentials.

Given a credential spec like
```json
    "credentialSpec": {
        "credentialType": "SomeVerifiedProperty",
        "arguments": {
            "argument_1": "value_1",
            "another_argument": 42,
        }
```
the returned JWT should contain in `credentialSubject` a property
named by the value of `credentialType` from the spec, with key-value
entries listing the arguments from the spec, namely
```json
    "SomeVerifiedProperty": {
        "argument_1": "value_1",
        "another_argument": 42,
    }
```

For example, for `VerifiedAdult`-credential we'd use the following credential spec
```json
    "credentialSpec": {
        "credentialType": "VerifiedAdult",
        "arguments": {
            "minAge": 18,
    }
```
and a compliant issuer would issue a VC that contains `credentialSubject` with the property
```json
    "VerifiedAdult": {
        "minAge": 18,
    }
```



## Resources

- [Verifiable credentials specification](https://github.com/dfinity/internet-identity/blob/main/docs/vc-spec.md).

- [Relying party demo](https://github.com/dfinity/vc-playground/tree/main/rp/frontend).

- [Verifiable credentials playground: Issuer](https://metaissuer.vc/).

- [Verifiable credentials playground: Relying party](https://relyingparty.vc/).
